-- This script was made by @ConePartyy on Roblox. Don't use this without my permission

-- // Configs

local configsTable = {};
local fileType = '.rfld';
local isConfigFolder = isfolder'cone';
local configFiles = isConfigFolder and listfiles'./cone';

game:GetService('RunService').Stepped:Wait()

isConfigFolder = isConfigFolder or isfolder'cone';
configFiles = configFiles or isConfigFolder and listfiles'./cone';

game:GetService('RunService').Stepped:Wait()

if not isConfigFolder then
	configFiles = {};
	warn('<< Econ >> Config folder not found, or an error occurred.')
elseif not configFiles then
	warn('<< Econ >> Waiting for config folder list.')
	repeat wait() until configFiles
end

for _, name in configFiles do
	if name:sub(#name-4,-1) == fileType then
		local readFile = readfile(name);
		local suc, rep = pcall(function()
			return game:GetService('HttpService'):JSONDecode(readFile);
		end);
		
		if suc and rep ~= '' then
			local fullName = name:sub(8,-1):sub(1,#name-12);
			table.insert(configsTable,fullName);
		else
			warn('<< Econ >> Read failed for file: ',rep)
		end;
	else
		warn('<< Econ >> File: "'..name..'" is not a .rfld [ Not Supported ]');
	end
end

-- // Main

----------- [ Executor Functions ] -----------

local SCRIPT_WHITELIST = {9139840720, 9390007618,9502659782};
local LOCAL_PLAYER = game:GetService('Players').LocalPlayer;

local request = (syn and syn.request) or (fluxus and fluxus.request) or (http and http.request) or http_request or request

if not table.find(SCRIPT_WHITELIST,LOCAL_PLAYER.UserId) then
	LOCAL_PLAYER:Kick("You don't have permission to use Econ")
	LOCAL_PLAYER.Parent = nil
	return
elseif not request then
	LOCAL_PLAYER:Kick('Your executor is not supported for Econ [ Missing function: "request" ]')
	return
end

local URL_ROOT = 'https://raw.githubusercontent.com/C0XNEcon/Econ3xC/refs/heads/main/'
local ECON_TOKEN = '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'
local __GETURL = function(URL)
	return request({Url = URL_ROOT..URL; Method = 'GET'; Headers = {
		Authorization = 'token '..ECON_TOKEN;
	}}).Body
end

----------- [ Services ] -----------

local Players           = game:GetService("Players")
local RunService        = game:GetService("RunService")
local UserInputService  = game:GetService("UserInputService")
local Workspace         = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ts                = game:GetService('TweenService')

local _aimShakeOffset = Vector3.zero;
local _cursorShakeOffset = Vector3.zero;
local _springMod = loadstring(__GETURL'Spring')();
local _camShaker = loadstring(__GETURL'CameraShaker')()
_camShaker[1].init(ECON_TOKEN)

local _cursorSpring = _springMod.new(Vector3.zAxis,1.5,8);
local _movementSpring = _springMod.new(Vector3.zAxis,1,8);

local _aimShake = _camShaker[2].new(5,function(cf:CFrame)
	_aimShakeOffset = cf.Position
end)

local _cursorShake = _camShaker[2].new(5,function(cf:CFrame)
	local p = cf.Position
	_cursorShakeOffset = Vector2.new(math.round(p.X),math.round(p.Y))
end)

_cursorShake:Start();
_aimShake:Start();

local _cursorShakeInstance = _cursorShake:StartShake(1,1,0,Vector3.one,Vector3.zero);
local _aimShakeInstance = _aimShake:StartShake(1,0,0,Vector3.zero,Vector3.zero);

----------- [ Main ] -----------

local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

local success, message = pcall(function()
	return
end)

if not success then
	warn('CONE InsH // '..message)
end

local file = success and message or 'true-false-true-false-true'
local splits = string.split(file, '-')

local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local function stb(str)
	return str == 'true'
end

local t = tostring

local spactivate = stb(splits[1])--false
local silactive = stb(splits[2])
local boxactive = stb(splits[3])
local reload = stb(splits[4])
local glass = stb(splits[5])
local igCheck = true

local fold = 'EconFold'

if not isfolder(fold) then
	makefolder(fold)
end

local function write()

end

local boxList = {}

local glassRevertList = {}
local keybinds = {'', 'G'}
local ac = {}
local noPlayers = ac
local notInMatch = {}
local plrToBox = {}

local vms = Workspace:WaitForChild('ViewModels'):WaitForChild('FirstPerson')

local sound = Instance.new('Sound')
sound.Volume = 1
sound.SoundId = 'rbxassetid://6895079853'

local knifeSound = Instance.new('Sound')
knifeSound.Volume = 1
knifeSound.SoundId = 'rbxassetid://17599589028'

local s2 = Instance.new('Sound')
s2.Volume = 1
s2.SoundId = 'rbxassetid://2865228021'

local function playSound(sp, rep, vol)
	local new = (rep or sound):Clone()
	new.Parent = workspace
	new.Volume = vol or 1
	new.PlaybackSpeed = sp or 1
	new:Play()

	new.Ended:Connect(function()
		new:Destroy()
	end)
end

if LocalPlayer:GetAttribute('OriginalPosition') then 
	LocalPlayer:SetAttribute('OriginalPosition', nil)		
end

LocalPlayer:SetAttribute('OriginalPosition', true)

local initConnections = {}
local on = true
local going = true

table.insert(initConnections, LocalPlayer:GetAttributeChangedSignal('OriginalPosition'):Connect(function()
	for _, v in pairs(initConnections) do
		v:Disconnect()
	end

	going = false
	on = false

	for _, v in pairs(boxList) do
		v.Visible = false
		v:Remove()
	end

	playSound(1.5, knifeSound)
	return
end))

playSound(f and .2 or 1.5)
f = true

local prms = RaycastParams.new()
prms.RespectCanCollide = true

local plr = Players.LocalPlayer
local m = plr:GetMouse()

-- // CARRELOAD

local _main = plr.PlayerGui:WaitForChild('MainGui').MainFrame
local _items = _main.FighterInterfaces:WaitForChild(plr.Name).Items:WaitForChild('Container')
local _connis = {}

if not on then return end

local NOCARRELOAD = {'Molotov', 'Grenade', 'Bow', 'Daggers'}
local ACCEPTEDCOOLDOWN = 'rbxassetid://17156089790'

local function _reloadcar(itemSlot)
	if itemSlot:IsA('Frame') and itemSlot.Name ~= 'AmmoContainers' and not table.find(NOCARRELOAD, itemSlot.Name) then
		local i = itemSlot.Name

		local con = _connis[i]
		if con then con:Disconnect() end

		pcall(function()
			local conni = nil
			conni = itemSlot.Cooldowns.ChildAdded:Connect(function(v)
				if v:IsA('Frame') and v.Icon.Image == ACCEPTEDCOOLDOWN and reload then
					conni:Disconnect()
					task.delay(.1, function()
						for i = 1, 4 do
							mousescroll(2345)
							RunService.RenderStepped:Wait()
						end
					end)
				elseif v:IsA('Frame') then
					table.insert(NOCARRELOAD, v.Name)
					conni:Disconnect()
				end
			end)

			table.insert(initConnections, conni)

			_connis[i] = conni
		end)
	end
end

for _, v in pairs(_items:GetChildren()) do
	_reloadcar(v)
end

table.insert(initConnections, _items.ChildAdded:Connect(_reloadcar))

-- // EconField Setup

local EconField = loadstring(__GETURL'Econ UI.txt')()

local Window = EconField:CreateWindow({
	Name = "Econ",
	Icon = 'code-xml',
	LoadingTitle = '',
	LoadingSubtitle = "by ConePartyy",
	Theme = "AmberGlow", 

	DisableEconFieldPrompts = true,
	DisableBuildWarnings = true,

	ConfigurationSaving = {
		Enabled = true,
		FolderName = 'cone',
		FileName = 'Default'
	},

	Discord = {
		Enabled = false,
		Invite = "acv8tdb8",
		RememberJoins = true
	},
})

_G.WINDOW_REPLACEMENT = Window

-- // Settings

local UGS = UserSettings():GetService('UserGameSettings')

local function mousesens()
	return UGS.MouseSensitivity
end

-- // Rest

local function getWeapon()
	for _, v in pairs(vms:GetChildren()) do
		if v.Name:split' - '[1] == plr.Name then
			local rest = v.Name:split' - '
			return rest[2]
		end
	end
end

local cw = nil
local handToo = {'Handgun', 'Fists'}

local function plrHasLoadout(plr)
	for _, v in pairs(ReplicatedStorage.Assets.Temp.ViewModels:GetChildren()) do
		if v.Name:split' - '[1] == plr.Name then
			return true
		end

		RunService.Stepped:Wait()
	end
end

local function getLoadout()
	local t = {}
	for i, v in ipairs(_items:GetChildren()) do
		if v.Name ~= 'AmmoContainers' and v:IsA('Frame') then
			table.insert(t, v.Name)
		end
	end

	for i = 1, math.floor(#t/2) do
		local j = #t - i + 1
		t[i], t[j] = t[j], t[i]
	end

	return t
end

local ps = LocalPlayer.PlayerScripts:WaitForChild('Assets')

local function check(v)
	if v.Name:split' - '[1] == plr.Name then
		local rest = v.Name:split(' - ')
		cw = v
	end
end

if vms:GetChildren()[1] then
	check(vms:GetChildren()[1])
end

local shra = true
local igam = true

local function id()
	return LocalPlayer:GetAttribute('EnvironmentID')
end

local function getNearestHead()
	local closestPlayer = nil
	local shortestDistance = math.huge
	local shortestDistance2 = math.huge

	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and (player:GetAttribute('EnvironmentID') == id() or not igCheck) and (not id() or id() ~= '߿' and igam or id() == '߿' and shra) and not table.find(noPlayers, player.UserId) and player.Character and player.Character:FindFirstChild("Head") then
			local char = player.Character
			local hum = char and char:FindFirstChild('Humanoid')
			local head = char.Head
			local headPos, headVisible = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))
			local distance = (head.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
			local distance2 = (Vector2.new(m.X, m.Y)-Vector2.new(headPos.X, headPos.Y)).Magnitude/2

			if distance2 < shortestDistance2 and hum.Health > 0 and headVisible then
				shortestDistance2 = distance2
				shortestDistance = distance
				closestPlayer = player
			end
		end
	end

	if closestPlayer and closestPlayer.Character and closestPlayer.Character:FindFirstChild("Head") then
		return closestPlayer.Character.Head
	end

	return nil
end

local cons = {}
local carRight = {'Knife', 'Grenade', 'Medkit', 'Smoke Grenade', 'Flashbang', 'Molotov', 'Fists'}

local katana = true
local carshoot = false

local f = nil
local lelCam = nil

local function char()
	return plr.Character, plr.Character.HumanoidRootPart
end

local ltick = tick()
local down2 = false

local lerp = 1
local sens = 1
local ads = 1

local Camera = workspace.CurrentCamera

local aimPredictionXZ, aimPredictionY = 1, 1;
local aimPredEnabled = true;
local shakeEnabled = true;
local cursorShakeEnabled = true;
local softLockEnabled = true;
local cursorSpringEnabled = true;
local cursorSpringDivider = 1;

local function moveMouseToWorldPosition(targetVector3)
	local screenSize = Camera.ViewportSize
	local screenCenter = Vector2.new(screenSize.X / 2, screenSize.Y / 2)

	local pos2, isOnScreen = Camera:WorldToViewportPoint(targetVector3)
	if pos2.Z <= 0 then
		pos2 *= -1
	end

	local viewportSize = workspace.CurrentCamera.ViewportSize
	pos2 = Vector3.new(math.clamp(pos2.X, 0, viewportSize.X),math.clamp(pos2.Y, 0, viewportSize.Y),0)

	if isOnScreen then
		local delta = (Vector2.new(pos2.X, pos2.Y) - screenCenter)*lerp;
		if cursorShakeEnabled then
			delta += _cursorShakeOffset;
		end;
		if cursorSpringEnabled then
			delta += Vector2.new(_cursorSpring.p.X/cursorSpringDivider,_cursorSpring.p.Y/cursorSpringDivider);
		end
		mousemoverel(delta.X, delta.Y);
		_cursorSpring:Impulse(Vector3.new(delta.X,delta.Y,1));
	end;
end

local last = false
local clickType = 'Head'
local trackType = 'Head'

local homeTab = Window:CreateTab('Home', 'crosshair') -- Title, Image
local aymSection = homeTab:CreateSection('Tracking')
local CoreGui = game:GetService('CoreGui')

local changeVal = Instance.new('Vector3Value', CoreGui:FindFirstChild("RobloxGui"))
local switch = false
local aymmode = 'MouseMoveRel'
changeVal.Name = 'ChangeVal'

task.spawn(function()
	while task.wait(2) do
		if going then
			switch = not switch
			ts:Create(changeVal, TweenInfo.new(2, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut), {Value = switch and Vector3.zero or Vector3.new(0, -1.5, 0)}):Play()
		else
			break
		end
	end
end)

local function car(right, needs, head)
	local weapon = getWeapon()
	local char = plr.Character;
	local root = char and char.PrimaryPart;
	if (spactivate or silactive or needs) and weapon and (not table.find(carRight, weapon) or needs) then
		local targetHead = head or f or getNearestHead()
		local targetChar = targetHead and targetHead.Parent
		local targetHum = targetChar and targetChar:FindFirstChild('Humanoid')
		local targetRoot = targetChar and targetChar.PrimaryPart
		if targetHead then
			f = nil

			local pos = targetHead.Position

			local typ = right and trackType or clickType
			if typ ~= 'Head' then
				pos = typ == 'Changing [ Outdated, use Aim Prediction ]' and targetHead.Position+changeVal.Value or targetHead.Parent.HumanoidRootPart.Position
			end

			local apos = pos
			local l = Camera.CFrame

			if weapon == 'Daggers' or weapon == 'Bow' then
				apos += Vector3.new(0, 1, 0)
			end
			
			if targetRoot and aimPredEnabled then
				local vel = targetRoot.Velocity::Vector3;
				local vel2 = (root and root.Velocity or Vector3.zero)::Vector3;
				local max = 20;
				
				local xz = max/aimPredictionXZ;
				local y = max/aimPredictionY;
				apos += Vector3.new(vel.X/xz,vel.Y/y,vel.Z/xz) - Vector3.new(vel2.X/xz,vel2.Y/y,vel2.Z/xz)
			end
			
			if shakeEnabled then
				apos += _aimShakeOffset
			end

			local x, y, z = targetHead.CFrame:ToOrientation()
			local cf = lelCam or right and weapon == 'Knife' and CFrame.new(Camera.CFrame.Position)*CFrame.Angles(x,y,z) or CFrame.new(Camera.CFrame.Position, apos)
			if iswindowactive() then
				if right or aymmode == 'MouseMoveRel' and silactive then
					if not right then
						for i = 1, 5 do
							moveMouseToWorldPosition(apos)
							ReplicatedStorage.Remotes.Attack:FireServer(targetHead)
							RunService.Stepped:Wait()
						end
					else
						moveMouseToWorldPosition(apos)
					end
				elseif not right then
					Camera.CFrame = cf
				end

				if carshoot then
					local ray = workspace:Raycast(Camera.CFrame.Position, Camera.CFrame.LookVector*50000)
					if ray then
						if ray.Instance and ray.Instance.Parent:FindFirstChild('Humanoid') then
							mouse1press()
							last = true
						elseif last then
							last = false
							mouse1release()
						end
					end
				end
			end

			lelCam = nil
			if right and weapon == 'Knife' then lelCam = cf end
			if not right then
				ReplicatedStorage.Remotes.Attack:FireServer(targetHead)
			end
		end
	end
end

local curr = false

table.insert(initConnections, m.Button2Down:Connect(function()
	down2 = true
	if spactivate then
		curr = true

		local lhead = nil
		local a = RunService.RenderStepped:Connect(function()
			if not lhead then
				lhead = getNearestHead()
			end

			if lhead then
				car(true,false,lhead)
			end
		end)

		table.insert(cons, a)
	end
end))

table.insert(initConnections, m.Button2Up:Connect(function()
	down2 = false
	curr = false
	for _, v in pairs(cons) do
		v:Disconnect()
	end
end))

local uip = game:GetService('UserInputService')
local players = game:GetService('Players')
local coreGui = game:GetService('CoreGui')

local plr = players.LocalPlayer 
local gui = plr.PlayerGui

local last = true

local legtrek = homeTab:CreateToggle({
	Name = 'Trackbot',
	CurrentValue = true,
	Flag = 'aimtracktogglekey',
	Callback = function(Value, nosound)
		spactivate = Value

		write()
		if not nosound then
			playSound(spactivate and 1 or .8)
		end
	end,
})

local keytrack = nil
local is = false
local Keybind = homeTab:CreateKeybind({
	Name = 'Trackbot Hold Keybind',
	CurrentKeybind = 'Backquote',
	HoldToInteract = false,
	Flag = 'trackforcekey',
	Callback = function(x, nosound)
		is = not is
		if is then
			local a = RunService.RenderStepped:Connect(function()
				if not curr then
					car(true, true)
				end
			end)

			keytrack = a
		elseif keytrack then
			keytrack:Disconnect()
		end
	end,
})

local trackTypeDropdown = homeTab:CreateDropdown({
	Name = 'Track Aim Part',
	Options = {'Head', 'Torso', 'Changing [ Outdated, use Aim Prediction ]'},
	CurrentOption = {'Torso'},
	MultipleOptions = false,
	Flag = 'trackaimpart',
	Callback = function(Options)
		trackType = Options[1]
	end,
})

local aymLerping = homeTab:CreateSlider({
	Name = 'Aim Lerping Alpha',
	Range = {5, 100},
	Increment = .5,
	Suffix = '',
	CurrentValue = 8.5,
	Flag = 'lerpSlider',
	Callback = function(Value)
		lerp = Value/100
	end,
})

homeTab:CreateSection('Aim Prediction')

local aimPredToggle = homeTab:CreateToggle({
	Name = 'Aim Prediction Enabled',
	CurrentValue = true,
	Flag = "aptggl",
	Callback = function(Value, nosound)
		aimPredEnabled = Value;
	end,
})

local aimPredXZ = homeTab:CreateSlider({
	Name = 'Aim Prediction X-Z',
	Range = {1, 100},
	Increment = .5,
	Suffix = '',
	CurrentValue = 60.5,
	Flag = 'apXZ',
	Callback = function(Value)
		aimPredictionXZ = Value/85
	end,
})

local aimPredY = homeTab:CreateSlider({
	Name = 'Aim Prediction Y',
	Range = {1, 100},
	Increment = .5,
	Suffix = '',
	CurrentValue = 42.5,
	Flag = 'apY',
	Callback = function(Value)
		aimPredictionY = Value/85
	end,
})


local legitTab = Window:CreateTab('Legit', 'search-check') -- Title, Image
--homeTab:CreateSection('Legit')

legitTab:CreateSection('Mouse Spring')

local mouseSpringEnabled = legitTab:CreateToggle({
	Name = 'Mouse Spring Enabled',
	CurrentValue = true,
	Flag = "mspre",
	Callback = function(Value, nosound)
		cursorSpringEnabled = Value;
	end,
})

local mouseSpringDivider = legitTab:CreateSlider({
	Name = 'Mouse Spring Divider',
	Range = {.3, 10},
	Increment = .05,
	Suffix = '',
	CurrentValue = 1.7,
	Flag = 'mousespringdivider',
	Callback = function(Value)
		cursorSpringDivider = Value
	end,
})

--local charShakeEnabled = homeTab:CreateToggle({
--	Name = 'Soft Lock Enabled',
--	CurrentValue = true,
--	Flag = "sfle",
--	Callback = function(Value, nosound)
--		softLockEnabled = Value;
--	end,
--})

legitTab:CreateDivider()

local charShakeEnabled = legitTab:CreateToggle({
	Name = 'Mouse Shake Enabled',
	CurrentValue = true,
	Flag = "mse",
	Callback = function(Value, nosound)
		cursorShakeEnabled = Value;
	end,
})

local cursorShakeOffset = legitTab:CreateSlider({
	Name = 'Mouse Shake Roughness',
	Range = {0, 40},
	Increment = .1,
	Suffix = '',
	CurrentValue = 15.3,
	Flag = 'mouseshakeroughness',
	Callback = function(Value)
		_cursorShakeInstance.Roughness = Value
	end,
})

local cursorShakeOffset = legitTab:CreateSlider({
	Name = 'Mouse Shake Magnitude',
	Range = {0, 100},
	Increment = 1,
	Suffix = '',
	CurrentValue = 14,
	Flag = 'mouseshakemagnitude',
	Callback = function(Value)
		_cursorShakeInstance.Magnitude = Value
	end,
})

legitTab:CreateDivider()

local shakeInfluenceXZ = 0;
local shakeInfluenceY = 0;

local charShakeEnabled = legitTab:CreateToggle({
	Name = 'Target Shake Enabled',
	CurrentValue = true,
	Flag = "tse",
	Callback = function(Value, nosound)
		shakeEnabled = Value;
	end,
})

local charShakeRoughness = legitTab:CreateSlider({
	Name = 'Target Shake Roughness',
	Range = {0, 15},
	Increment = .1,
	Suffix = '',
	CurrentValue = 4.3,
	Flag = 'soRHN',
	Callback = function(Value)
		_aimShakeInstance.Roughness = Value
	end,
})

local charShakeOffsetXZ = legitTab:CreateSlider({
	Name = 'Target Shake X-Z',
	Range = {0, 30},
	Increment = .1,
	Suffix = '',
	CurrentValue = 16.3,
	Flag = 'soXZ',
	Callback = function(Value)
		shakeInfluenceXZ = Value
	end,
})

local charShakeOffsetY = legitTab:CreateSlider({
	Name = 'Target Shake Y',
	Range = {0, 30},
	Increment = .1,
	Suffix = '',
	CurrentValue = 8.8,
	Flag = 'soY',
	Callback = function(Value)
		shakeInfluenceY = Value
	end,
})

homeTab:CreateSection('Sensitivity [ Copy ur RIVALS settings ]')

local sens = homeTab:CreateSlider({
	Name = 'Sensitivity',
	Range = {.05, 4},
	Increment = .05,
	Suffix = '',
	CurrentValue = 1,
	Flag = 'senslider',
	Callback = function(Value)
		sens = Value
	end,
})

local sens = homeTab:CreateSlider({
	Name = 'ADS Sensitivity Multiplier',
	Range = {.05, 2},
	Increment = .05,
	Suffix = '',
	CurrentValue = 1,
	Flag = 'adsenseslider',
	Callback = function(Value)
		ads = Value
	end,
})

homeTab:CreateSection('Configs')

if not isfile'EconConfig' then
	writefile('EconConfig','Default')
end

local infoLabel = homeTab:CreateLabel('Adding a new config clones the current', 6026568210, Color3.fromRGB(220, 130, 60), false)
local currentConfig = readfile'EconConfig' or configsTable[1] or 'Default';
local newConfigName = 'Unnamed Config';

local configDropdown = homeTab:CreateDropdown({
	Name = 'Select Config',
	Options = configsTable,
	CurrentOption = {currentConfig},
	MultipleOptions = false,
	Ext = true; -- // Were not saving the save config :sob: wait what did i just say
	Flag = 'sconfigdd',
	Callback = function(Options,noPrev)
		if noPrev ~= true then
			currentConfig = Options[1];

			writefile('EconConfig',currentConfig)
			EconField.CONE_FILE_NAME = './cone/'..currentConfig;
			
			local _fullFilePath = `./cone/{currentConfig}{fileType}`;
			if not isfile(_fullFilePath) then
				repeat RunService.Stepped:Wait() until isfile(_fullFilePath);
			end; -- // If it isn't a file, it will bug
			
			EconField:LoadConfiguration();
		end
	end,
})

function updConfigDropdown(noPreviousSave,noLoad,noSet)
	configDropdown:Refresh(configsTable);
	if not noLoad then
		task.spawn(function()
			configDropdown:Close()
		end)
		
		configDropdown:Set({currentConfig},noPreviousSave and 'NoPrevSave' or noSet);
	end
end

local configName = homeTab:CreateInput({
	Name = 'Config Name',
	CurrentValue = '',
	PlaceholderText = 'Unnamed Config',
	Ext = true,
	Flag = 'cfninput',
	Callback = function(txt, nosound)
		newConfigName = txt:gsub('/',''):gsub('%.',''):gsub(':','')
	end,
})

local configNew = homeTab:CreateButton({
	Name = 'New Config',
	Ext = true;
	Callback = function()
		if newConfigName == '' then
			newConfigName = 'Unnamed'
		end

		local fullPath = './cone/'..newConfigName..fileType;
		local isFile = table.find(configsTable,newConfigName);
		
		local suc, rep = pcall(function()
			return EconField:SaveConfiguration(nil,fullPath)
		end)
		
		if not table.find(configsTable,newConfigName) then
			table.insert(configsTable,newConfigName);
		end;
		
		currentConfig = newConfigName
		updConfigDropdown(true)
		
		if suc then
			EconField:Notify({
				Title = isFile and 'Updated Config "'..newConfigName..'"' or 'New Config "'..newConfigName..'"',
				Content = `Succesfully {isFile and 'Updated' or 'Added'} Config "{newConfigName}"`, 
				Image = 6026568210,
				Duration = 5,
			})
		else
			EconField:Notify({
				Title = 'Config Add Fail';
				Content = `An error occurred adding config: {rep}`, 
				Image = 6031071057,
				Duration = 7,
			})
		end
	end,
})

local delConfig = homeTab:CreateButton({
	Name = 'Remove Selected Config',
	Ext = true;
	Callback = function()
		local fullPath = './cone/'..currentConfig..fileType;
		local suc, rep = pcall(function()
			if #configsTable > 1 then
				return delfile(fullPath)
			else
				error("This is your only config!")
			end
		end)

		if suc then
			local i = table.find(configsTable,currentConfig);
			if i then
				table.remove(configsTable,i);
			end;

			EconField:Notify({
				Title = 'Config Removed',
				Content = `Succesfully Removed Config "{currentConfig}"`, 
				Image = 6022668939,
				Duration = 5,
			})
			
			currentConfig = configsTable[1];
			updConfigDropdown(true);
		else
			EconField:Notify({
				Title = 'Config Remove Fail';
				Content = rep, 
				Image = 6031071057,
				Duration = 7,
			})
		end
	end,
})

local gameplayTab = Window:CreateTab('Gameplay', 'swords') -- Title, Image
local boxSection = gameplayTab:CreateSection'ESP'

local evtype = 'Off'
local gui = {}
local shooting_range = '߿'

local function canPopup()
	return evtype == 'Always' or evtype == 'With ESP' and boxactive
end

local plrToG = {}
local function popUpd()
	local cp = canPopup()
	for _, v in pairs(gui) do
		v.Enabled = cp
	end
end

local boxEnabled = gameplayTab:CreateToggle({
	Name = 'Enabled',
	CurrentValue = false,
	Flag = "boxetoggle",
	Callback = function(Value, nosound)
		boxactive = Value
		write()

		popUpd()

		if not nosound then
			playSound(boxactive and 1 or .8)
		end
	end,
})

local espType = 'Boxes'
local espop = gameplayTab:CreateDropdown({
	Name = 'ESP Type',
	Options = {'Boxes', 'Highlights', 'Both'},
	CurrentOption = {'Boxes'},
	MultipleOptions = false,
	Flag = 'esptdropdown',
	Callback = function(Options, nosound)
		espType = Options[1]
		if not nosound then
			playSound(1)
		end
	end,
})

local boxNAC = Color3.fromRGB(70, 53, 44)
local boxCOL = Color3.fromRGB(255, 143, 52)

local boxColor = gameplayTab:CreateColorPicker({
	Name = 'ESP Color',
	Color = Color3.fromRGB(255, 143, 52),
	Flag = 'ESPColor',
	Callback = function(Value)
		boxCOL = Value
	end
})

local boxNoaymbotColor = gameplayTab:CreateColorPicker({
	Name = 'ESP No aimbot Color',
	Color = Color3.fromRGB(70, 53, 44),
	Flag = 'NAColor',
	Callback = function(Value)
		boxNAC = Value
	end
})

local visualSection = gameplayTab:CreateSection('Enemy Visuals')

local evpop = gameplayTab:CreateDropdown({
	Name = 'Enemy Health',
	Options = {'Off', 'With ESP', 'Always'},
	CurrentOption = {'Off'},
	MultipleOptions = false,
	Flag = 'evpopdropdown',
	Callback = function(Options, nosound)
		evtype = Options[1]
		popUpd()
		if not nosound then
			playSound(1)
		end
	end,
})

-- // HEALTH

local plrs = game:GetService('Players')
local nl = plrs.LocalPlayer.PlayerScripts.UserInterface:WaitForChild('TeammateLabel')

-- // REST

local deviceSection = gameplayTab:CreateSection('Device')
local deviceDropdown = gameplayTab:CreateDropdown({
	Name = 'Change Device',
	Options = {'VR', 'Touch', 'Gamepad', 'MouseKeyboard'},
	CurrentOption = {'MouseKeyboard'},
	MultipleOptions = false,
	Flag = 'devicedrop',
	Callback = function(Options)
		ReplicatedStorage.Remotes.Replication.Fighter.SetControls:FireServer(Options[1])
	end,
})

local gameplaySection = gameplayTab:CreateSection('Gameplay')

local CARRELOAD = gameplayTab:CreateToggle({
	Name = 'Auto Reload',
	CurrentValue = false,
	Flag = "artoggle",
	Callback = function(Value, nosound)
		reload = Value
		write()

		if not nosound then
			playSound(reload and 1 or .8)
		end
	end,
})

local carshoot = gameplayTab:CreateToggle({
	Name = 'Auto Shoot [ Buggy ]',
	CurrentValue = false,
	Flag = "astoggle",
	Callback = function(Value, nosound)
		carshoot = Value

		if not nosound then
			playSound(carshoot and 1 or .8)
		end
	end,
})

local carKatana = gameplayTab:CreateToggle({
	Name = 'Auto Katana [ Unreliable ]',
	CurrentValue = true,
	Flag = "aktoggle",
	Callback = function(Value, nosound)
		katana = Value

		if not nosound then
			playSound(katana and 1 or .8)
		end
	end,
})

local teamCheck = gameplayTab:CreateToggle({
	Name = 'Team Check [ Recommended ]',
	CurrentValue = true,
	Flag = "tctoggle",
	Callback = function(Value, nosound)
		if Value then
			noPlayers = ac 
		else
			noPlayers = {}
		end

		if not nosound then
			playSound(Value and 1 or .8)
		end 
	end,
})

local ingameCheck = gameplayTab:CreateToggle({
	Name = 'Match Check [ Recommended ]',
	CurrentValue = true,
	Flag = "ictoggle",
	Callback = function(Value, nosound)
		igCheck = Value

		if not nosound then
			playSound(Value and 1 or .8)
		end
	end,
})

local environmentsTab = Window:CreateTab('Places', 'map-pin')
local environmentsSection = environmentsTab:CreateSection('Enabled Places')

local shootingRange = environmentsTab:CreateToggle({
	Name = 'Shooting Range',
	CurrentValue = true,
	Flag = "srtoggle",
	Callback = function(Value, nosound)
		shra = Value

		if not nosound then
			playSound(shra and 1 or .8)
		end
	end,
})

local ingame_ = environmentsTab:CreateToggle({
	Name = 'Ingame',
	CurrentValue = true,
	Flag = "ingtoggle",
	Callback = function(Value, nosound)
		igam = Value

		if not nosound then
			playSound(igam and 1 or .8)
		end
	end,
})

local movementTab = Window:CreateTab('Movement', 'move')

movementTab:CreateSection('Basic Movement')

local function lerpz(start, goal, alpha)
	return start + (goal - start) * alpha
end

local slide = .7
local function sj()
	local plr = Players.LocalPlayer
	local char = plr.Character
	if char then
		local fm2 = char:FindFirstChild('FakeMass')
		local root = char.PrimaryPart
		if fm2 then
			local c = fm2.CurrentPhysicalProperties
			local z = PhysicalProperties.new(slide, c.Friction, c.Elasticity, c.FrictionWeight, c.ElasticityWeight)
			fm2.CustomPhysicalProperties = z
		end
	end
end

local slideJumpMult = movementTab:CreateSlider({
	Name = 'Slide Jump Hack',
	Range = {0, 100},
	Increment = 1,
	Suffix = '',
	CurrentValue = 6,
	Flag = 'slideSlider',
	Callback = function(Value)
		slide = lerpz(.7, 0, Value/100)
	end,
})

-- // Skin

_G.ECON_UI = EconField
_G.SIGNAL_QUEUE = true
task.spawn(function()
	loadstring(__GETURL'MainSkin')()
end)

-- // Rest

table.insert(initConnections, RunService.RenderStepped:Connect(sj))
table.insert(initConnections, UserInputService.InputBegan:Connect(function(input, processed)
	local b = table.find(keybinds, input.KeyCode.Name)
	local ld = getLoadout()

	if input.KeyCode.Name == 'F' and ld[3] == 'Katana' and not processed then
		if katana then
			for i = 1, 10 do
				mouse2click(1)
				RunService.Stepped:Wait()
			end
		end
	elseif input.UserInputType == Enum.UserInputType.MouseButton1 and silactive then
		car()
	elseif input.KeyCode == Enum.KeyCode.T and not processed then
		boxEnabled:Set(not boxactive)
	elseif input.KeyCode.Name == 'Y' and not processed then
		legtrek:Set(not spactivate)
	end
end))

local function updAc()
	if #noPlayers > 0 then
		noPlayers = ac
	end
end

local h = game:GetObjects("rbxassetid://87957938793907")[1]
h.Parent = workspace

-- CREATE

local e = Instance.new('Highlight', h.Enemy)
e.FillColor = Color3.new(0, 0, 1)
e.FillTransparency = .8
e.OutlineColor = Color3.new(0, 0, 1)

local t = Instance.new('Highlight', h.Team)
t.FillColor = Color3.fromRGB(0, 191, 191)
t.FillTransparency = .8
t.OutlineColor = Color3.fromRGB(0, 229, 255)

local o = Instance.new('Highlight', h)
o.FillColor = Color3.fromRGB(150, 100, 100)
o.FillTransparency = .9
o.OutlineColor = Color3.fromRGB(150, 100, 100)
o.Name = 'Off'

-- REST

local hs = {} -- HIGHLIGHTS
for _, v in pairs(h:GetDescendants()) do
	if v:IsA('Highlight') and v.Name ~= 'Off' then
		hs[v] = {
			FillColor = v.FillColor,
			OutlineColor = v.OutlineColor,
			FillTransparency = v.FillTransparency,
		}
	end
end

table.insert(initConnections, RunService.RenderStepped:Connect(function()
	_aimShakeInstance.PositionInfluence = Vector3.new(shakeInfluenceXZ,shakeInfluenceY,shakeInfluenceXZ)
	for he, set in pairs(hs) do
		he.Enabled = espType ~= 'Boxes' and boxactive
		if he.Enabled then
			if not (silactive or spactivate) then
				he.FillColor = h.Off.FillColor
				he.FillTransparency = h.Off.FillTransparency
				he.OutlineColor = h.Off.OutlineColor
			else
				for name, og in pairs(set) do
					he[name] = og
				end
			end
		end
	end
end))

local c = 4
local function createbox(player)
	if player ~= LocalPlayer then
		local boxBox = Drawing.new("Quad")
		boxBox.Thickness = 2
		boxBox.Transparency = 1
		boxBox.Visible = true

		local function col()
			boxBox.Color = (silactive or spactivate) and (table.find(ac, player.UserId) and Color3.fromRGB(0, 255, 255) or boxCOL) or boxNAC
		end

		col()

		boxList[player.Name] = boxBox

		local added = false
		local addedNoMatch = false
		local func = nil

		local label = nil
		local hum = nil

		local function upz()
			if hum and label then
				local alpha = hum.Health / hum.MaxHealth
				local lerp = Color3.fromRGB(255, 50, 50):Lerp(Color3.fromRGB(255, 215, 0):Lerp(Color3.fromRGB(100, 255, 50), alpha), alpha)

				local h = label:FindFirstChild('Health')
				if h then
					label.Health.Bar.Size = UDim2.new(alpha, 0, 1, 0)
					label.Health.BackgroundColor3 = Color3.new(lerp.R / 2, lerp.G / 2, lerp.B / 2)
					label.Health.UIStroke.Color = Color3.new(lerp.R * 0.25, lerp.G * 0.25, lerp.B * 0.25)
					label.Health.Bar.BackgroundColor3 = lerp
					label.Health.Bar.UIStroke.Color = lerp
				end

				if hum.Health <= 0 then
					label:Destroy()
				end
			end
		end

		local function x(char)
			local root = char:WaitForChild('HumanoidRootPart')
			local hum2 = char:WaitForChild('Humanoid')

			hum = hum2
			label = nl:Clone()
			label.MaxDistance = 350
			label.Name = 'EnemyLabel'
			label.Parent = root
			label.Player.Visible = false
			label.Enabled = canPopup()
			plrToG[label] = player
			table.insert(gui, label) 

			spawn(function()
				while char and char.Parent and label and label:FindFirstChild('Health') do
					label.Health.Visible = plrHasLoadout(player)
					wait()
				end 
			end)

			local function check()
				local l = root:FindFirstChild('TeammateLabel')
				if l and l.Enabled then
					if not added then
						added = true
						table.insert(ac, player.UserId)
						player:SetAttribute('IsTeam', true)
						label.MaxDistance = 0
						updAc()
					end
				elseif added then
					added = false
					player:SetAttribute('IsTeam', false)
					label.MaxDistance = 350
					table.remove(ac, table.find(ac, player.UserId))
					updAc()
				end

				col()
			end

			func = check

			check()

			table.insert(initConnections, root.ChildAdded:Connect(check))
		end

		table.insert(initConnections, player.CharacterAdded:Connect(x))
		if player.Character then
			x(player.Character)
		end

		local function invis()
			boxBox.PointA = Vector2.new(-math.huge, -math.huge)
			boxBox.PointB = Vector2.new(-math.huge, -math.huge)
			boxBox.PointC = Vector2.new(-math.huge, -math.huge)
			boxBox.PointD = Vector2.new(-math.huge, -math.huge)
		end

		table.insert(initConnections, RunService.RenderStepped:Connect(function()
			local char = player.Character
			local hum = char and char:FindFirstChild('Humanoid')
			local root = char and char:FindFirstChild('HumanoidRootPart')

			if boxactive and not table.find(noPlayers, player.UserId) and (player:GetAttribute('EnvironmentID') == LocalPlayer:GetAttribute('EnvironmentID') or not igCheck) and (not id() or id() ~= '߿' and igam or id() == '߿' and shra) and root and hum and hum.Health > 0 and player.Character:FindFirstChild("HumanoidRootPart") and getWeapon() then
				local head = player.Character:FindFirstChild("Head")

				if root and head then
					local rootPos, rootVisible = Camera:WorldToViewportPoint(root.Position)
					local headPos, headVisible = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 0.5, 0))

					if rootVisible and headVisible then
						if espType == 'Both' then
							boxBox.PointA = Vector2.new(rootPos.X - 15, rootPos.Y + 30)
							boxBox.PointB = Vector2.new(rootPos.X + 15, rootPos.Y + 30)
							boxBox.PointC = Vector2.new(headPos.X + 15, headPos.Y)
							boxBox.PointD = Vector2.new(headPos.X - 15, headPos.Y)

							if char then
								char.Parent = player:GetAttribute('IsTeam') and h.Team or h.Enemy
							end

							boxBox.Transparency = 0
							boxBox.Visible = true
						else
							if espType == 'Boxes' then
								boxBox.PointA = Vector2.new(rootPos.X - 15, rootPos.Y + 30)
								boxBox.PointB = Vector2.new(rootPos.X + 15, rootPos.Y + 30)
								boxBox.PointC = Vector2.new(headPos.X + 15, headPos.Y)
								boxBox.PointD = Vector2.new(headPos.X - 15, headPos.Y)

								if char then
									char.Parent = workspace
								end

								boxBox.Transparency = 0
								boxBox.Visible = true
							else
								if char then
									char.Parent = player:GetAttribute('IsTeam') and h.Team or h.Enemy
								end

								invis()
								boxBox.Transparency = 1
								boxBox.Visible = false
							end
						end
					else
						invis()
						if char then
							char.Parent = workspace
						end
						boxBox.Transparency = 1
						boxBox.Visible = false
					end
				else
					invis()
					if char then
						char.Parent = workspace
					end
					boxBox.Transparency = 1
					boxBox.Visible = false
				end
			else
				invis()
				if char and char.Parent then
					char.Parent = workspace
				end
				
				boxBox.Transparency = 1
				boxBox.Visible = false
			end

			if label and label.Enabled then
				upz()
			end

			if func then
				func()
			end
		end))
	end
end

for _, player in pairs(Players:GetPlayers()) do
	createbox(player)
end

table.insert(initConnections, Players.PlayerAdded:Connect(function(player)
	createbox(player)
end))

table.insert(initConnections, Players.PlayerRemoving:Connect(function(player)
	if boxList[player.Name] then
		boxList[player.Name]:Remove()
		boxList[player.Name] = nil
	end
end))

EconField.CONE_FILE_NAME = './cone/'..currentConfig
EconField:LoadConfiguration(true)
updConfigDropdown(nil,nil,true)

queue_on_teleport(__GETURL'Main.txt')
